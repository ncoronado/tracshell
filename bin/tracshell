#!/usr/bin/env python

import sys
from optparse import OptionParser

from tracshell import settings
from tracshell import shell

def run():
    """
    This function starts the main program.
    """
    p = OptionParser(version="TracShell: %f" % shell.VERSION)
    p.add_option("--site", "-s", dest="site",
                 action="store", type="string",
                 default=None, help="Optional site to connect to")
    p.add_option("--file", "-f", dest="file",
                 action="store", type="string",
                 default=".tracshell", help="Specify the name of your settings file")
    opts, args = p.parse_args()

    s = settings.Settings(filename=opts.file)
    if opts.site:
        site = s.sites[opts.site]
    else:
        try:
            site = s.sites[s.default_site]
        except AttributeError:
            raise settings.ConfigError, "No default site specified"
        except KeyError:
            raise settings.ConfigError, "No default site specified"

    shell.start_shell(site.user, site.passwd, site.host, port=site.port,
        secure=site.secure, rpc_path=site.path)


if __name__ == '__main__':
    run()
